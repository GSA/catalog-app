version: 2
jobs:
  build:
    machine: true
    steps:
      - checkout
      - run:
          name: Run tests
          command: make test

  deploy_cloud_gov:
    machine: true
    steps:
      - run:
          command: |
            curl -v -L -o cf-cli_amd64.deb 'https://cli.run.pivotal.io/stable?release=debian64&source=github'
            sudo dpkg -i cf-cli_amd64.deb
            cf -v
            cf api https://api.fr.cloud.gov            
            cf auth
            cf target -o gsa-datagov -s development
            cf push --vars-file vars.ci.yaml

workflows:
  version: 2
  main:
    jobs:
      - deploy_cloud_gov
#      - build
